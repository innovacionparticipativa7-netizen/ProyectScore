<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Medidores por Casillas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 40px;
        }

        .container {
            max-width: 650px;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: auto;
        }

        h2 {
            text-align: center;
        }

        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 25px;
        }

        .meter {
            margin-bottom: 30px;
        }

        .meter-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .checkboxes label {
            display: block;
            margin-bottom: 5px;
        }

        .progress {
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: #007bff;
            transition: width 0.3s;
        }

        .percentage {
            text-align: right;
            font-size: 14px;
            margin-top: 5px;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #218838;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Panel de Proyectos</h2>

    <label>Seleccionar Proyecto</label>
    <select id="proyecto" onchange="cargarProyecto(this.value)">
        <option value="Proyecto A">Proyecto A</option>
        <option value="Proyecto B">Proyecto B</option>
        <option value="Proyecto C">Proyecto C</option>
    </select>


    <!-- PSR -->
   <div class="meter" id="psr">
  <div class="meter-title">PSR</div>

  <div class="checkboxes" id="psr-list"></div>

  <button onclick="agregarRequisito('psr')">+ Agregar requisito</button>

  <div class="progress">
    <div class="progress-bar" id="psr-bar"></div>
  </div>

  <div class="percentage" id="psr-percent">0%</div>
</div>

    



    <!-- KPI -->
    <div class="meter" id="kpi">
  <div class="meter-title">KPI</div>

  <div class="checkboxes" id="psr-list"></div>

  <button onclick="agregarRequisito('kpi')">+ Agregar requisito</button>

  <div class="progress">
    <div class="progress-bar" id="kpi-bar"></div>
  </div>

  <div class="percentage" id="kpi-percent">0%</div>
</div>



    <!-- PLAN -->
    <div class="meter" id="plan">
  <div class="meter-title">PLAN</div>

  <div class="checkboxes" id="plan-list"></div>

  <button onclick="agregarRequisito('plan')">+ Agregar requisito</button>

  <div class="progress">
    <div class="progress-bar" id="plan-bar"></div>
  </div>

  <div class="percentage" id="plan-percent">0%</div>
</div>

    


<script type="module">
  // Importar Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


  // CONFIGURACIÓN (PEGA AQUÍ LA TUYA)
  const firebaseConfig = {
  apiKey: "AIzaSyAoVH8wQ2ofolAaJYdFnu1COcwI-xvaNnM",
  authDomain: "panel-proyectos-f119f.firebaseapp.com",
  projectId: "panel-proyectos-f119f",
  storageBucket: "panel-proyectos-f119f.firebasestorage.app",
  messagingSenderId: "780366850885",
  appId: "1:780366850885:web:fa282efbac6b3b51dcec2c",
  measurementId: "G-RV3YHXWQ0J"
};

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // FUNCIÓN GUARDAR
  window.guardar = async function () {
  const proyecto = document.getElementById("proyecto").value;

  const obtenerDatos = (tipo) => {
    const labels = document.querySelectorAll(`#${tipo}-list label`);
    return [...labels].map(l => ({
      texto: l.textContent.trim(),
      checked: l.querySelector("input").checked
    }));
  };

  const datos = {
    psr: obtenerDatos("psr"),
    kpi: obtenerDatos("kpi"),
    plan: obtenerDatos("plan"),
    fecha: new Date()
  };

  await setDoc(doc(db, "proyectos", proyecto), datos);
  alert("Proyecto guardado ✅");
};


    window.actualizar = function (tipo) {
  const contenedor = document.getElementById(`${tipo}-list`);
  const checks = contenedor.querySelectorAll('input[type="checkbox"]');

  const total = checks.length || 1;
  const marcados = [...checks].filter(c => c.checked).length;
  const porcentaje = Math.round((marcados / total) * 100);

  document.getElementById(`${tipo}-bar`).style.width = porcentaje + "%";
  document.getElementById(`${tipo}-percent`).textContent = porcentaje + "%";
};


async function cargarProyecto(nombre) {
  const snap = await getDoc(doc(db, "proyectos", nombre));

  const cargar = (tipo, data) => {
    const contenedor = document.getElementById(`${tipo}-list`);
    contenedor.innerHTML = "";

    if (!data) return actualizar(tipo);

    data.forEach(r =>
      agregarRequisito(tipo, r.texto, r.checked)
    );

    actualizar(tipo);
  };

  if (snap.exists()) {
    const d = snap.data();
    cargar("psr", d.psr);
    cargar("kpi", d.kpi);
    cargar("plan", d.plan);
  } else {
    cargar("psr");
    cargar("kpi");
    cargar("plan");
  }
}

    window.agregarRequisito = function (tipo, texto = "Nuevo requisito", checked = false) {
  const contenedor = document.getElementById(`${tipo}-list`);

  const label = document.createElement("label");
  const checkbox = document.createElement("input");

  checkbox.type = "checkbox";
  checkbox.checked = checked;
  checkbox.onchange = () => actualizar(tipo);

  label.appendChild(checkbox);
  label.append(" " + texto);

  contenedor.appendChild(label);
};

window.cargarProyecto = cargarProyecto;
</script>


</body>
</html>










